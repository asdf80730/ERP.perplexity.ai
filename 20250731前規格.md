
# 簡易庫存管理系統規格表

## 一、 總體目標

建立一個基於 Google Sheet 的簡易庫存管理系統，提供直覺且僅支援手機操作的 Web 介面。

## 二、 設計原則

*   **手機優先 (Mobile-First)：** 所有介面設計與功能考量均以手機螢幕和觸控操作為主。不再考慮桌面版畫面。**確保文字大小在手機上清晰可讀。**
*   **數據同步：** 所有新增、刪除、修改操作均即時同步至 Google Sheet。
*   **操作直覺：** 介面簡潔，盡量減少不必要的點擊與頁面跳轉。
*   **GAS 環境限制：** 前端所有程式碼（HTML, CSS, JavaScript）必須包含在**單一的 `index.html` 檔案中**。

## 三、 模組列表與功能詳述

系統將包含以下五個主要模組：

1.  **首頁 (Dashboard)**
2.  **地點管理 (Location Management)**
3.  **產品管理 (Product Management)**
4.  **交易管理 (Transaction Management)**
5.  **庫存查詢 (Inventory Query)**

### 3.1 首頁 (Dashboard)

*   **功能：** 顯示系統概覽及快速操作入口。
    *   提供「入庫」與「出庫」按鈕，用於快速進行交易。
    *   顯示近七天內的出入庫紀錄列表。
*   **細節：**
    *   **UI 佈局調整：** `h2` "首頁" 標題位於左側，"入庫" 與 "出庫" 按鈕位於同一行的右側。
    *   點擊「入庫」或「出庫」按鈕，應彈出一個模態框，讓使用者選擇產品、地點、數量及備註，完成單筆或批量入庫/出庫操作。
    *   模態框內選擇產品時，需提供廠牌及類別的篩選功能。
    *   模態框內，入庫/出庫數量輸入欄位旁，需有「+」和「-」按鈕可調整數量，預設數量為 1。
    *   出庫模態框需有基本庫存檢查，並顯示當前庫存量以供參考。
    *   模態框內支援一次多筆新增暫存，使用者可添加多行記錄（每行代表一個不同產品在不同地點的入庫/出庫操作），待使用者確認後才一次同步至 Google Sheet。
        *   **注意：交易 ID 將由系統自動生成，使用者無需輸入。**
    *   近七天內出入庫紀錄：
        *   顯示項目為：日期、產品名稱、數量。
        *   交易類型與數量以明顯顏色合併顯示 (例如綠色 +1 或紅色 -1)。
*   **相關函式：**
    *   **前端:** `showHomePage()`, `openTransactionModal(type)`, `addTransactionRow()`, `removeTransactionRow()`, `updateQuantityInput()`, `checkOutboundInventory()`, `submitBulkTransactions()`
    *   **後端 (Apps Script):** `getRecentTransactions()`, `addBulkTransactionsAndUpdateInventory()`

### 3.2 地點管理 (Location Management)

*   **功能：** 管理所有庫存地點的增、刪、改。
*   **細節：**
    *   **UI 佈局調整：** `h2` "地點管理" 標題位於左側，"新增地點"、"編輯"、"刪除" 按鈕位於同一行的右側。
    *   **顯示：** 以表格形式列出所有地點，包含「地點名稱」、「地點數量」。 「地點ID」不應顯示。「地點數量」為存放該地點的商品總件數 (即該地點下所有產品的總數量)。
        *   **常駐顯示：** 每行右側**常駐顯示**一個「編輯」按鈕。在非刪除模式下，最右側的表頭為「操作」。
    *   **搜尋/篩選：** 提供文字輸入框，可實時篩選地點名稱。**篩選框將套用統一的 CSS 樣式。**
    *   **新增：**
        *   點擊「新增地點」按鈕，彈出模態框。
        *   模態框內可輸入地點名稱。**使用者無需輸入地點 ID，ID 將由系統自動生成。**
        *   支援**批量暫存**，允許連續新增多個地點後一次性確認提交。
        *   提交後即時同步至 Google Sheet。
    *   **編輯 (單獨功能)：**
        *   **每次只能編輯一行**：當一行進入編輯狀態時，其他行的「編輯」按鈕會**失效（禁用）**。
        *   點擊每行右側的「編輯」按鈕。
        *   該行的「地點名稱」會轉換為輸入框。
        *   該行的「編輯」按鈕會替換為「儲存」按鈕（**無「取消」按鈕**）。
        *   「地點數量」欄位在編輯模式下不可編輯。
        *   點擊「儲存」後，更新地點名稱並即時同步至 Google Sheet。
    *   **刪除 (獨立模式)：**
        *   提供一個獨立的「刪除」按鈕（不同於編輯）。
        *   點擊「刪除」按鈕後，進入**刪除模式**：
            *   表格最右側的表頭「操作」改為「刪除」。
            *   每行常駐的「編輯」按鈕**隱藏**，並顯示核取方塊。
            *   頂部的「刪除」按鈕文本改為「確認刪除」。
            *   新增一個「取消刪除」按鈕。**「取消刪除」按鈕將顯示為橘色。**
        *   使用者勾選欲刪除的地點。
        *   刪除地點時，**強制提供一個選項，允許將該地點下的所有商品轉移到另一個指定的「統一地點」**，以避免庫存數據遺失。若選擇轉移，統一地點的庫存將直接疊加進去。
        *   點擊「確認刪除」按鈕，選中的地點將被批量刪除，並即時同步至 Google Sheet。
        *   點擊「取消刪除」按鈕，退出刪除模式而不執行刪除。
*   **相關函式：**
    *   **前端:** `showLocationPage()`, `filterLocations()`, `openAddLocationModal()`, `addLocationToBatch()`, `removeLocationFromBatch()`, `submitAddLocations()`, `editLocation(locationId)`, `saveLocation(locationId)`, `toggleLocationDeleteMode()`, `confirmDeleteLocations()`
    *   **後端 (Apps Script):** `getLocationsWithCounts()`, `addLocations()`, `updateLocationName(locationId, newName)`, `deleteLocationsAndTransferInventory()`

### 3.3 產品管理 (Product Management)

*   **功能：** 管理所有產品資訊的增、刪、改。
*   **細節：**
    *   **UI 佈局調整：** `h2` "產品管理" 標題位於左側，"新增產品"、"編輯"、"刪除" 按鈕位於同一行的右側。
    *   **顯示：** 以表格形式列出所有產品，包含「產品名稱」、「品牌」、「類別」。 「產品ID」不應顯示。顯示順序為「類別」、「品牌」、「產品名稱」。
        *   **常駐顯示：** 每行右側**常駐顯示**一個「編輯」按鈕。在非刪除模式下，最右側的表頭為「操作」。
    *   **搜尋/篩選：** 提供文字輸入框，可實時篩選產品名稱、品牌或類別。搜尋/篩選時，避免頻繁從 Google Sheet 讀取資料。應於切換至產品管理時一次讀取並暫存所有產品資料。**篩選框將套用統一的 CSS 樣式。**
    *   **新增：**
        *   點擊「新增產品」按鈕，彈出模態框。
        *   模態框內可輸入產品名稱、品牌、類別。**使用者無需輸入產品 ID，ID 將由系統自動生成。**
        *   支援**批量暫存**。
        *   提交後即時同步至 Google Sheet。
    *   **編輯 (單獨功能)：**
        *   **每次只能編輯一行**：當一行進入編輯狀態時，其他行的「編輯」按鈕會**失效（禁用）**。
        *   點擊每行右側的「編輯」按鈕。
        *   該行的「產品名稱」、「品牌」、「類別」會轉換為輸入框/下拉選單。
        *   該行的「編輯」按鈕會替換為「儲存」按鈕（**無「取消」按鈕**）。
        *   點擊「儲存」後，更新產品資訊並即時同步至 Google Sheet。
    *   **刪除 (獨立模式)：**
        *   提供一個獨立的「刪除」按鈕。
        *   點擊「刪除」按鈕後，進入**刪除模式**：
            *   表格最右側的表頭「操作」改為「刪除」。
            *   每行常駐的「編輯」按鈕**隱藏**，並顯示核取方塊。
            *   頂部的「刪除」按鈕文本改為「確認刪除」。
            *   新增一個「取消刪除」按鈕。**「取消刪除」按鈕將顯示為橘色。**
        *   使用者勾選欲刪除的產品。
        *   點擊「確認刪除」按鈕，選中的產品將被批量刪除，並即時同步至 Google Sheet。
        *   點擊「取消刪除」按鈕，退出刪除模式而不執行刪除。
*   **相關函式：**
    *   **前端:** `showProductPage()`, `filterProducts()`, `openAddProductModal()`, `addProductToBatch()`, `removeProductFromBatch()`, `submitAddProducts()`, `editProduct(productId)`, `saveProduct(productId)`, `toggleProductDeleteMode()`, `confirmDeleteProducts()`
    *   **後端 (Apps Script):** `getProducts()`, `addProducts()`, `updateProduct(productId, newProductName, newBrand, newCategory)`, `deleteProducts()`

### 3.4 交易管理 (Transaction Management)

*   **功能：** 顯示所有交易紀錄，並支援增、刪、改功能，與地點及產品管理頁面相同。
*   **細節：**
    *   **UI 佈局調整：** `h2` "交易管理" 標題位於左側，"入庫"、"出庫"、"編輯"、"刪除" 按鈕位於同一行的右側。
    *   **顯示：** 以表格形式列出所有交易記錄。「交易ID」不應顯示。顯示順序為「時間戳 (只要日期)」、「產品名稱」、「地點名稱」、「數量 (與類型合併並以明顯顏色合併顯示，例如綠色 +1 或紅色 -1)」、「備註」。
        *   **常駐顯示：** 每行右側**常駐顯示**一個「編輯」按鈕（或直接可點擊該行進入編輯）。在非刪除模式下，最右側的表頭為「操作」。
    *   **搜尋/篩選：**
        *   提供文字輸入框，可實時篩選交易類型、產品、地點或備註。
        *   新增年份輸入框 (預設今年) **年** 月份下拉選單，用於篩選交易紀錄。**篩選框將套用統一的 CSS 樣式。**
    *   **新增：** 提供「入庫」與「出庫」按鈕，功能與首頁的入/出庫模態框相同。**注意：交易 ID 將由系統自動生成，使用者無需輸入。**
        *   **「出庫」按鈕將改為棕色**。
    *   **編輯 (單獨功能)：**
        *   **每次只能編輯一行**：當一行進入編輯狀態時，其他行的「編輯」按鈕會**失效（禁用）**。
        *   點擊每行右側的「編輯」按鈕或直接點擊該行。
        *   彈出編輯模態框，可修改「備註」和「數量」。**產品和地點資訊在編輯時不可修改**。
        *   修改數量時，後端需同步調整庫存。
        *   點擊「儲存」後，更新交易並即時同步至 Google Sheet。
    *   **刪除 (獨立模式)：**
        *   提供一個獨立的「刪除」按鈕。
        *   點擊「刪除」按鈕後，進入**刪除模式**：
            *   表格最右側的表頭「操作」改為「刪除」。
            *   每行常駐的「編輯」按鈕**隱藏**，並顯示核取方塊。
            *   頂部的「刪除」按鈕文本改為「確認刪除」。
            *   新增一個「取消刪除」按鈕。**「取消刪除」按鈕將顯示為橘色。**
        *   使用者勾選欲刪除的交易。
        *   點擊「確認刪除」按鈕，選中的交易將被批量刪除，並即時同步至 Google Sheet。
        *   點擊「取消刪除」按鈕，退出刪除模式而不執行操作。
*   **相關函式：**
    *   **前端:** `showTransactionPage()`, `filterTransactions()`, `openTransactionModal(type)` (同首頁), `editTransaction(transactionId)`, `submitEditTransaction()`, `toggleTransactionDeleteMode()`, `confirmDeleteTransactions()`
    *   **後端 (Apps Script):** `getTransactions()`, `addBulkTransactionsAndUpdateInventory()` (同首頁), `updateTransactionAndInventory()`, `deleteTransactionsAndUpdateInventory()`

### 3.5 庫存查詢 (Inventory Query)

*   **功能：** 讓使用者快速查詢特定條件下的庫存狀況。
*   **細節：**
    *   **UI 佈局調整：** `h2` "庫存查詢" 標題位於左側，無其他按鈕。
    *   **輸入：** 提供下拉式選單供使用者選擇「地點」、「產品品牌」、「產品類別」。
    *   **篩選觸發：** 使用者透過下拉式方塊選擇後，直接觸發篩選，無需再按「查詢庫存」按鈕。
    *   **顯示：** 以表格形式顯示篩選後的庫存數據。顯示順序為「品牌」、「產品類別」、「地點名稱」、「數量」。
    *   產品ID不做顯示。
*   **相關函式：**
    *   **前端:** `showInventoryPage()`, `performInventoryQuery()`
    *   **後端 (Apps Script):** `getInventoryData()`

## 四、 詳細運作流程

### 4.1 系統初始化與數據載入

*   **觸發條件：** 用戶首次打開 Web App 或刷新頁面時。
*   **前端 (JavaScript) 動作：**
    1.  調用 `google.script.run.withSuccessHandler(initializeAppData).getAllInitialData()` 向後端發送請求。
*   **後端 (Apps Script) 函式：** `getAllInitialData()`
    1.  從 Google Sheet 的 "Locations"、"Products"、"Inventory" 和 "Transactions" 工作表中讀取所有數據。
    2.  計算並匯總各地點的商品總件數。
    3.  將所有數據組合成一個 JSON 對象返回給前端。
*   **前端 (JavaScript) 函式：** `initializeAppData(data)`
    1.  接收後端返回的 `data`。
    2.  將數據緩存在全局變數 `appData` 中 (`appData.locations`, `appData.products`, `appData.inventory`, `appData.transactions`)。
    3.  根據 `appData.transactions` 中的數據，調用 `getRecentTransactions()` (前端函式，處理數據篩選和渲染) 渲染近七天內的出入庫紀錄到首頁。
    4.  填充所有相關的下拉選單（例如：庫存查詢的地點/品牌/類別，首頁/交易管理入庫/出庫模態框的產品/地點）。
    5.  默認顯示「首頁」Tab (`showHomePage()` )。

### 4.2 Tab 切換

*   **觸發條件：** 用戶點擊導航欄的 Tab 按鈕（或手機上的下拉選單）切換模組。
*   **前端 (JavaScript) 函式：** `switchTab(tabName)`
    1.  隱藏當前活躍 Tab 內容。
    2.  顯示目標 Tab 的內容。
    3.  更新導航按鈕的活躍狀態。
    4.  **如果從刪除模式切換到其他 Tab，或切換回原 Tab，該 Tab 的刪除模式應自動退出並重置 UI。**
    5.  根據 `tabName` 調用對應的顯示函式：
        *   `tabName === 'home'`: `showHomePage()`
        *   `tabName === 'locations'`: `showLocationPage()`
        *   `tabName === 'products'`: `showProductPage()`
        *   `tabName === 'transactions'`: `showTransactionPage()`
        *   `tabName === 'inventory'`: `showInventoryPage()`

### 4.3 數據同步機制

*   **所有數據同步操作均通過 `google.script.run` 觸發後端 Apps Script 函式，並在成功回調 (`.withSuccessHandler()`) 中執行前端數據更新及頁面刷新。**
*   **新增操作 (地點、產品、首頁/交易管理 的入/出庫交易)：**
    1.  **前端：** 收集模態框中暫存的批量數據。**不包含 ID。**
    2.  **前端函式：**
        *   地點新增：`submitAddLocations()`
        *   產品新增：`submitAddProducts()`
        *   交易新增：`submitBulkTransactions()`
    3.  **後端 (Apps Script) 函式：**
        *   地點新增：`addLocations(newLocationsArray)` (**函式內部負責生成 LocationID**)。
        *   產品新增：`addProducts(newProductsArray)` (**函式內部負責生成 ProductID**)。
        *   交易新增：`addBulkTransactionsAndUpdateInventory(transactionsArray)` (**函式內部負責生成 TransactionID**，並負責同時新增交易記錄與更新 `Inventory` 表)。
    4.  **成功後：** 後端返回更新後的數據，前端調用 `initializeAppData()` 重新載入所有數據並關閉模態框，刷新頁面。

*   **刪除操作 (地點、產品、交易管理)：**
    1.  **前端：** 收集被選中欲刪除項目的 ID 列表，地點刪除時還需收集轉移目標地點的 ID。
    2.  **前端函式：**
        *   地點刪除：`confirmDeleteLocations(locationIds, transferToLocationId)`
        *   產品刪除：`confirmDeleteProducts(productIds)`
        *   交易刪除：`confirmDeleteTransactions(transactionIds)`
    3.  **後端 (Apps Script) 函式：**
        *   地點刪除：`deleteLocationsAndTransferInventory(locationIds, transferToLocationId)` (負責將庫存轉移後再刪除地點及相關庫存)
        *   產品刪除：`deleteProducts(productIds)` (負責刪除產品，並處理相關庫存：例如標記為無效或提示)
        *   交易刪除：`deleteTransactionsAndInventory(transactionIds)` (負責刪除交易並同步調整庫存)
    4.  **成功後：** 後端返回更新後的數據，前端調用 `initializeAppData()` 重新載入所有數據並退出編輯模式，刷新頁面。

*   **修改操作 (地點、產品、交易管理)：**
    1.  **觸發條件：** 使用者在編輯模式下點擊「儲存」按鈕。
    2.  **前端 (JavaScript) 動作：**
        *   收集被修改項目（地點、產品或交易）的 ID 及新的數據。
        *   **地點修改：** `saveLocation(locationId, newName)`
        *   **產品修改：** `saveProduct(productId, newProductName, newBrand, newCategory)`
        *   **交易修改：** `submitEditTransaction(transactionId, newNotes, newQuantity)`
    3.  **後端 (Apps Script) 函式：**
        *   **地點修改：** `updateLocationName(locationId, newName)`
        *   **產品修改：** `updateProduct(productId, newProductName, newBrand, newCategory)`
        *   **交易修改：** `updateTransactionAndInventory(transactionId, newNotes, newQuantity)` (負責更新交易記錄並根據數量差異更新庫存)
    4.  **成功後：** 後端返回更新後的數據，前端調用 `initializeAppData()` 重新載入所有數據並結束該行的編輯狀態，刷新頁面。若為模態框編輯（交易），則關閉模態框。

## 五、 表格欄位定義 (Google Sheet Schemas)

### a. Locations (地點)

*   `LocationID` (String): 地點唯一標識符 (**由 Apps Script 自動生成，前綴 "L"**)
*   `LocationName` (String): 地點名稱 (例如: "倉庫", "店面", "貨架A")

### b. Products (產品)

*   `ProductID` (String): 產品唯一標識符 (**由 Apps Script 自動生成，前綴 "P"**)
*   `ProductName` (String): 產品名稱 (例如: "筆記型電腦", "滑鼠", "鍵盤")
*   `Brand` (String): 品牌 (例如: "Dell", "Logitech", "Razer")
*   `Category` (String): 類別 (例如: "電子產品", "辦公用品", "配件")

### c. Inventory (庫存)

*   `InventoryID` (String): 庫存記錄唯一標識符 (由 Apps Script 自動生成，前綴 "I")
*   `ProductID` (String): 產品唯一標識符 (外鍵，鏈接到 Products 表)
*   `LocationID` (String): 地點唯一標識符 (外鍵，鏈接到 Locations 表)
*   `Quantity` (Number): 該產品在該地點的數量

### d. Transactions (交易)

*   `TransactionID` (String): 交易記錄唯一標識符 (**由 Apps Script 自動生成，前綴 "T"**)
*   `Timestamp` (String): 交易時間戳 (格式例如: "2023/10/27 14:30:00")
*   `Type` (String): 交易類型 ("In" 入庫, "Out" 出庫)
*   `ProductID` (String): 產品唯一標識符 (外鍵)
*   `LocationID` (String): 地點唯一標識符 (外鍵)
*   `Quantity` (Number): 交易數量
*   `Notes` (String): 備註 (可選)

## 六、 後續開發與維護注意事項

1.  **庫存數量更新：** 已確認所有涉及數量變更的操作（入庫、出庫、交易修改、交易刪除、地點刪除並轉移）都將同步更新 `Inventory` 表中的 `Quantity`。需要確保邏輯的準確性和數據一致性，並處理庫存不足的出庫情況。
2.  **庫存關聯刪除：**
    *   刪除地點時，已明確透過強制轉移避免庫存數據遺失。
    *   刪除產品時，應考慮如何處理 `Inventory` 表中相關的記錄。建議將這些庫存記錄的 `ProductID` 清空或標記為無效，而不是直接刪除 `Inventory` 記錄，以保留歷史數據。
3.  **錯誤處理與用戶反饋：** 強化前端的錯誤提示機制，提供更友好的用戶體驗（例如：操作成功或失敗的通知、錯誤訊息顯示）。
4.  **性能優化：** 考慮數據量增大時，前端篩選和表格渲染的性能問題（例如：虛擬捲動、分頁）。
5.  **測試：** 對於每個功能模組進行充分的測試，特別是批量操作和數據同步的穩定性及數據一致性。

## 七、 開發代辦事項 (TODO List)

以下是根據目前討論，需要逐步完成的開發任務：

### 階段一：前端 UI 樣式與基本功能微調 (不涉及複雜邏輯重構)

*   [ ] **通用 UI 優化：**
    *   [ ] **字體大小調整：**
        *   **分析：** 目前 `body` 元素沒有明確設定 `font-size` (繼承瀏覽器預設 16px)。`tab-button`、表單輸入框/選擇框、模態框按鈕為 16px。表格頭部為 14px，表格內按鈕為 13px。`h2` 標題繼承瀏覽器預設。
        *   **目標：** 確保所有文字在手機上具有良好的可讀性。考慮將基礎字體（例如 `body`）提升至 17px 或 18px，並相應調整其他元素的大小。**初步建議將 `body` 的 `font-size` 設定為 `17px`，並相應檢查和調整其他元素的 `font-size`，例如將 13px 提升到 14px/15px，14px 提升到 15px/16px，以確保層次感和可讀性。**
    *   [ ] **篩選框樣式統一：** 為地點管理、產品管理、交易管理頁面的搜尋/篩選輸入框和選擇框套用統一的 CSS 樣式。
*   [ ] **首頁模組優化：**
    *   [ ] **「入庫」/「出庫」模態框：「新增一筆」按鈕樣式：** 為模態框中的「新增一筆」按鈕套用 `primary` 按鈕樣式。
    *   [ ] **「出庫」按鈕顏色：** 將首頁及交易管理頁面的「出庫」按鈕顏色由灰色（`secondary`）調整為棕色（需定義新的 CSS 類別）。
    *   [ ] **「移除」按鈕（暫時）：** 鑒於批量新增 UI 仍在階段三規劃，目前模態框內的單筆「移除」按鈕**暫不進行樣式或顯示邏輯調整**。其最終實現（以 "X" 形式出現在暫存表格內）將在階段三完成。
*   [ ] **地點管理模組優化：**
    *   [ ] **「新增地點」模態框：「新增一列地點」按鈕樣式：** 為模態框中的「新增一列地點」按鈕套用 `primary` 按鈕樣式。
    *   [ ] **「取消刪除」按鈕顏色：** 將地點管理頁面刪除模式下的「取消刪除」按鈕顏色調整為橘色（需定義新的 CSS 類別）。
*   [ ] **產品管理模組優化：**
    *   [ ] **「新增產品」模態框：「新增一列產品」按鈕樣式：** 為模態框中的「新增一列產品」按鈕套用 `primary` 按鈕樣式。
    *   [ ] **「取消刪除」按鈕顏色：** 將產品管理頁面刪除模式下的「取消刪除」按鈕顏色調整為橘色。
*   [ ] **交易管理模組優化：**
    *   [ ] **年月篩選顯示：** 在年份輸入框後增加「年」字樣，使其顯示為「年份輸入框 年 月份下拉選單」。
    *   [ ] **「取消刪除」按鈕顏色：** 將交易管理頁面刪除模式下的「取消刪除」按鈕顏色調整為橘色。
*   [ ] **刪除模式狀態重置：**
    *   [ ] 確保在「地點管理」、「產品管理」、「交易管理」頁面，當從刪除模式切換到其他 Tab，或切換回原 Tab 時，該 Tab 的刪除模式應**自動退出並重置 UI**（例如：取消勾選所有核取方塊，隱藏「取消刪除」按鈕，恢復正常操作按鈕）。

### 階段二：模態框實作 (UI/UX 獨立部分，不涉及複雜邏輯重構)

*   [ ] **通用模態框結構：** 創建一個可重用的模態框 HTML/CSS 結構。
*   [ ] **入庫/出庫模態框：**
    *   [ ] 實現產品、地點下拉選單及篩選。
    *   [ ] 實現數量增減按鈕。
*   [ ] **地點刪除確認/轉移模態框：** 實現選擇轉移地點的邏輯。
*   [ ] **交易編輯模態框：** 實現備註、數量修改功能。

### 階段三：批量新增 UI 重構與高級錯誤提示

*   [ ] **批量新增 UI 重構 (地點、產品、交易)：**
    *   [ ] 修改新增模態框的布局，將當前的輸入欄位設計為「單筆輸入區塊」。
    *   [ ] 在「單筆輸入區塊」下方，新增一個區域用於**表格顯示已暫存的批量數據**。
    *   [ ] 為表格中的每條暫存數據提供「編輯」和「移除 (以 "X" 形式)」功能。
    *   [ ] 「新增一筆/新增一列」按鈕的功能變為：將「單筆輸入區塊」的內容添加到下方的暫存表格中。
*   [ ] **錯誤訊息顯示優化：**
    *   [ ] 修改 `showToast()` 函數的實現，使錯誤訊息能夠**直接顯示在對應的輸入框下方**，並以紅色文字標示。
    *   [ ] 確保輸入框內容修正後，錯誤訊息自動消失。
*   [ ] **入庫/出庫模態框：**
    *   [ ] 實現批量新增多行交易記錄功能 (基於上述批量新增 UI 重構)。

### 階段四：前端與 Apps Script 連結

*   [ ] **Apps Script (Code.gs) 環境設置：**
    *   [ ] 部署為 Web 應用程式。
    *   [ ] 設置 `doGet()` 函數以返回 `index.html`。
*   [ ] **後端數據讀取 (getAllInitialData)：**
    *   [ ] 實現 `getAllInitialData()` 函數從 Google Sheet 讀取所有必要數據。
    *   [ ] 將前端 `initializeAppData()` 連接到 `google.script.run.withSuccessHandler(initializeAppData).getAllInitialData()`。
*   [ ] **數據新增功能 (addLocations, addProducts, addBulkTransactionsAndUpdateInventory)：**
    *   [ ] 實現所有新增功能的 Apps Script 函式，並負責生成唯一 ID。
    *   [ ] 將前端的 `submitAddLocations()`, `submitAddProducts()`, `submitBulkTransactions()` 連接到對應的 Apps Script 函式。
*   [ ] **數據修改功能 (updateLocationName, updateProduct, updateTransactionAndInventory)：**
    *   [ ] 實現所有修改功能的 Apps Script 函式。
    *   [ ] 將前端的 `saveLocation()`, `saveProduct()`, `submitEditTransaction()` 連接到對應的 Apps Script 函式。
*   [ ] **數據刪除功能 (deleteLocationsAndTransferInventory, deleteProducts, deleteTransactionsAndInventory)：**
    *   [ ] 實現所有刪除功能的 Apps Script 函式，特別處理地點刪除時的庫存轉移。
    *   [ ] 將前端的 `confirmDeleteLocations()`, `confirmDeleteProducts()`, `confirmDeleteTransactions()` 連接到對應的 Apps Script 函式。
*   [ ] **庫存查詢數據 (getInventoryData)：**
    *   [ ] 實現 `getInventoryData()` 函式以提供前端所需的庫存數據。
    *   [ ] 確保前端 `performInventoryQuery()` 調用正確。

我理解您的困擾。我使用了一種叫做 "Artifact" 的特殊格式來呈現長篇文字（例如規格表或程式碼），並附帶一個 id 和 type。這個功能是為了將某些特定的輸出內容結構化，使其更容易被識別和處理，並且能夠在需要時進行引用。