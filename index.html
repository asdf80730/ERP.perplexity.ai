<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>進銷存管理系統</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="mobile-app">
    <!-- 主要內容區域 -->
    <main class="main-container">
        <!-- 首頁 -->
        <div id="home" class="page active">
            <div class="page-header">
                <div class="header-title">
                    <h1>進銷存管理</h1>
                    <div class="connection-status" id="connection-status">
                        <span class="status-dot" id="status-dot"></span>
                        <span id="status-text">正在連接...</span>
                    </div>
                </div>
            </div>

            <!-- 統計卡片 -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📦</div>
                    <div class="stat-content">
                        <div class="stat-number" id="total-products">0</div>
                        <div class="stat-label">商品種類</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🏪</div>
                    <div class="stat-content">
                        <div class="stat-number" id="total-locations">0</div>
                        <div class="stat-label">存放地點</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-content">
                        <div class="stat-number" id="total-inventory">0</div>
                        <div class="stat-label">總庫存</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">📝</div>
                    <div class="stat-content">
                        <div class="stat-number" id="today-transactions">0</div>
                        <div class="stat-label">今日異動</div>
                    </div>
                </div>
            </div>

            <!-- 快速操作 -->
            <div class="quick-actions">
                <h3>快速操作</h3>
                <div class="action-grid">
                    <button class="action-btn stock-in-btn" onclick="showQuickStockIn()">
                        <div class="action-icon">📥</div>
                        <span>進貨</span>
                    </button>
                    <button class="action-btn stock-out-btn" onclick="showQuickStockOut()">
                        <div class="action-icon">📤</div>
                        <span>出貨</span>
                    </button>
                    <button class="action-btn" onclick="showPage('products')">
                        <div class="action-icon">➕</div>
                        <span>新增商品</span>
                    </button>
                    <button class="action-btn" onclick="showPage('inventory')">
                        <div class="action-icon">🔍</div>
                        <span>庫存查詢</span>
                    </button>
                </div>
            </div>

            <!-- 庫存警告 -->
            <div class="section">
                <h3>庫存警告</h3>
                <div id="low-stock-alerts" class="alert-container">
                    <div class="no-data">暫無庫存警告</div>
                </div>
            </div>

            <!-- 最近異動 -->
            <div class="section">
                <h3>最近異動</h3>
                <div id="recent-records" class="records-container">
                    <div class="no-data">暫無異動記錄</div>
                </div>
            </div>
        </div>

        <!-- 商品管理 -->
        <div id="products" class="page">
            <div class="page-header">
                <h2>商品管理</h2>
                <div class="header-actions">
                    <button class="btn btn--primary" onclick="showProductModal()">
                        <span>➕</span>
                        新增商品
                    </button>
                </div>
            </div>

            <div class="search-section">
                <div class="search-input-container">
                    <input type="text" 
                           class="search-input" 
                           id="product-search" 
                           placeholder="搜尋商品名稱..."
                           oninput="filterProducts()">
                    <div class="search-icon">🔍</div>
                </div>
            </div>

            <div class="list-container" id="products-list">
                <div class="no-data">暫無商品資料</div>
            </div>
        </div>

        <!-- 庫存查詢 -->
        <div id="inventory" class="page">
            <div class="page-header">
                <h2>庫存查詢</h2>
                <button class="btn btn--outline" onclick="refreshInventory()">
                    <span>🔄</span>
                    刷新
                </button>
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">全部</button>
                <button class="filter-tab" data-filter="low">庫存不足</button>
                <button class="filter-tab" data-filter="empty">缺貨</button>
            </div>

            <div class="search-section">
                <div class="search-input-container">
                    <input type="text" 
                           class="search-input" 
                           id="inventory-search" 
                           placeholder="搜尋商品或地點..."
                           oninput="filterInventory()">
                    <div class="search-icon">🔍</div>
                </div>
            </div>

            <div class="list-container" id="inventory-list">
                <div class="no-data">暫無庫存資料</div>
            </div>
        </div>

        <!-- 記錄查看 -->
        <div id="records" class="page">
            <div class="page-header">
                <h2>異動記錄</h2>
                <button class="btn btn--outline" onclick="refreshRecords()">
                    <span>🔄</span>
                    刷新
                </button>
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">全部</button>
                <button class="filter-tab" data-filter="in">進貨</button>
                <button class="filter-tab" data-filter="out">出貨</button>
            </div>

            <div class="list-container" id="records-list">
                <div class="no-data">暫無異動記錄</div>
            </div>
        </div>

        <!-- 設定 -->
        <div id="settings" class="page">
            <div class="page-header">
                <h2>系統設定</h2>
            </div>

            <div class="settings-section">
                <div class="setting-group">
                    <h3>Google Sheets 整合</h3>
                    <div class="setting-item">
                        <label class="setting-label">GAS Web App URL</label>
                        <input type="url" 
                               class="form-control" 
                               id="gas-url" 
                               placeholder="請輸入 GAS URL">
                        <div class="setting-actions">
                            <button class="btn btn--outline" onclick="testGasConnection()">測試連接</button>
                            <button class="btn btn--primary" onclick="saveGasSettings()">儲存</button>
                        </div>
                        <div id="gas-connection-status" class="connection-result"></div>
                    </div>
                </div>

                <div class="setting-group">
                    <h3>同步設定</h3>
                    <div class="setting-item">
                        <label class="setting-checkbox">
                            <input type="checkbox" id="auto-sync-enabled">
                            <span class="checkmark"></span>
                            啟用自動同步
                        </label>
                        <p class="setting-desc">當啟用時，每次資料異動後會自動同步到Google Sheets</p>
                    </div>
                    <div class="setting-actions">
                        <button class="btn btn--primary" onclick="syncAllData()">立即同步</button>
                        <button class="btn btn--outline" onclick="pullFromGas()">從雲端拉取</button>
                    </div>
                    <div id="last-sync-time" class="sync-info"></div>
                </div>

                <div class="setting-group">
                    <h3>庫存警告</h3>
                    <div class="setting-item">
                        <label class="setting-label">庫存不足警告數量</label>
                        <input type="number" 
                               class="form-control" 
                               id="low-stock-threshold" 
                               min="0" 
                               value="5"
                               onchange="updateLowStockThreshold()">
                    </div>
                </div>

                <div class="setting-group">
                    <h3>資料管理</h3>
                    <div class="setting-actions">
                        <button class="btn btn--outline" onclick="backupData()">備份資料</button>
                        <button class="btn btn--outline" onclick="restoreData()">還原資料</button>
                        <button class="btn btn--secondary" onclick="clearAllData()">清除資料</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 底部導航 -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-page="home">
            <div class="nav-icon">🏠</div>
            <span class="nav-label">首頁</span>
        </button>
        <button class="nav-item" data-page="products">
            <div class="nav-icon">📦</div>
            <span class="nav-label">商品</span>
        </button>
        <button class="nav-item" data-page="inventory">
            <div class="nav-icon">📊</div>
            <span class="nav-label">庫存</span>
        </button>
        <button class="nav-item" data-page="records">
            <div class="nav-icon">📝</div>
            <span class="nav-label">記錄</span>
        </button>
        <button class="nav-item" data-page="settings">
            <div class="nav-icon">⚙️</div>
            <span class="nav-label">設定</span>
        </button>
    </nav>

    <!-- 快速進貨模態框 -->
    <div id="stock-in-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>快速進貨</h3>
                <button class="modal-close" onclick="hideModal('stock-in-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="stock-in-form" onsubmit="handleStockIn(event)">
                    <div class="form-group">
                        <label class="form-label">地點</label>
                        <select class="form-control" id="stock-in-location" required>
                            <option value="">請選擇地點</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">商品</label>
                        <select class="form-control" id="stock-in-product" required>
                            <option value="">請選擇商品</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">數量</label>
                        <div class="quantity-input">
                            <button type="button" class="quantity-btn" onclick="adjustQuantity('stock-in-quantity', -1)">-</button>
                            <input type="number" class="form-control quantity-field" id="stock-in-quantity" min="1" value="1" required>
                            <button type="button" class="quantity-btn" onclick="adjustQuantity('stock-in-quantity', 1)">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">操作員</label>
                        <input type="text" class="form-control" id="stock-in-operator" placeholder="輸入操作員名稱">
                    </div>
                    <div class="form-group">
                        <label class="form-label">備註</label>
                        <input type="text" class="form-control" id="stock-in-note" placeholder="進貨備註（選填）">
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width">確認進貨</button>
                </form>
            </div>
        </div>
    </div>

    <!-- 快速出貨模態框 -->
    <div id="stock-out-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>快速出貨</h3>
                <button class="modal-close" onclick="hideModal('stock-out-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="stock-out-form" onsubmit="handleStockOut(event)">
                    <div class="form-group">
                        <label class="form-label">地點</label>
                        <select class="form-control" id="stock-out-location" required onchange="updateStockAvailability()">
                            <option value="">請選擇地點</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">商品</label>
                        <select class="form-control" id="stock-out-product" required onchange="updateStockAvailability()">
                            <option value="">請選擇商品</option>
                        </select>
                    </div>
                    <div id="stock-availability" class="stock-info"></div>
                    <div class="form-group">
                        <label class="form-label">數量</label>
                        <div class="quantity-input">
                            <button type="button" class="quantity-btn" onclick="adjustQuantity('stock-out-quantity', -1)">-</button>
                            <input type="number" class="form-control quantity-field" id="stock-out-quantity" min="1" value="1" required>
                            <button type="button" class="quantity-btn" onclick="adjustQuantity('stock-out-quantity', 1)">+</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">操作員</label>
                        <input type="text" class="form-control" id="stock-out-operator" placeholder="輸入操作員名稱">
                    </div>
                    <div class="form-group">
                        <label class="form-label">備註</label>
                        <input type="text" class="form-control" id="stock-out-note" placeholder="出貨備註（選填）">
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width">確認出貨</button>
                </form>
            </div>
        </div>
    </div>

    <!-- 商品模態框 -->
    <div id="product-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="product-modal-title">新增商品</h3>
                <button class="modal-close" onclick="hideModal('product-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="product-form" onsubmit="saveProduct(event)">
                    <div class="form-group">
                        <label class="form-label">商品編號</label>
                        <input type="text" class="form-control" id="product-id" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">商品名稱</label>
                        <input type="text" class="form-control" id="product-name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">單位</label>
                        <input type="text" class="form-control" id="product-unit" placeholder="例：個、盒、件" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">類別</label>
                        <input type="text" class="form-control" id="product-category" placeholder="商品類別（選填）">
                    </div>
                    <div class="form-group">
                        <label class="form-label">描述</label>
                        <textarea class="form-control" id="product-description" rows="3" placeholder="商品描述（選填）"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn--outline" onclick="hideModal('product-modal')">取消</button>
                        <button type="submit" class="btn btn--primary">儲存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 通知訊息 -->
    <div id="notification" class="notification hidden">
        <div class="notification-content">
            <span id="notification-message"></span>
            <button id="notification-close" onclick="hideNotification()">&times;</button>
        </div>
    </div>

    <!-- 載入指示器 -->
    <div id="loading" class="loading hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text">處理中...</div>
    </div>

    <script src="app.js"></script>
</body>
</html>